{% extends 'index.html' %}

{% block body %}
<div class="container-fluid">

    <form method="post" action="/admin/report" class="row">
        
        <div class="form-group col-md-4">
            <label for="start_date">Start Date:</label>
            <input type="text" class="form-control datepicker" name="start_date" id="start_date" placeholder="Select Start Date of Search" class="form-control" value="{{ start_date }}" readonly>
        </div>
        
        <div class="form-group col-md-4">
            <label for="end_date">End Date:</label>
            <input type="text" id="end_date" name="end_date" class="form-control datepicker" placeholder="Select End Date of Search" value="{{ end_date }}" readonly>
        </div>
        
        <div class="form-group col-md-4 align-self-end">
            <button type="submit" class="btn btn-dark btn-block" id="generateReport">Generate Report</button>
        </div>
    </form>

    {% if search_queries %}
    <hr>
    <h2>Search Queries Report</h2>
    <table id="searchQueriesTable" class="table table-striped table-bordered">
        <thead class="table-dark">
            <tr>
                <th>Date</th>
                <th>User</th>
                <th>Search Query</th>
            </tr>
        </thead>
        <tbody>
            {% for query in search_queries %}
            <tr>
                <td>{{ query.timestamp }}</td>
                <td>{{ query.email }}</td>
                <td>{{ query.search_query }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div id="noSearchFoundMessage" class="alert alert-info" role="alert" style="display: block;">
        No search founds for the entered criteria.
    </div>
    <div id="searchQueriesTable" style="display: none;">
        <!-- Placeholder for report table -->
    </div>
    {% endif %}
</div>
     
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
 
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
<script>
    $(document).ready(function () {
        // Initialize datepicker
        $('.datepicker').datepicker({
            format: 'yyyy-mm-dd',
            autoclose: true,
            todayHighlight: true,
            endDate: new Date(),  // Restrict to today's date and earlier
            todayBtn: true
        });

        // Add click event listener to Generate Report button
        $('#generateReport').click(function () {
            // Check if there are no search queries
            if ($('#searchQueriesTable tbody tr').length === 0) {
                $('#noSearchFoundMessage').show();  // Show the message
                $('#searchQueriesTable').hide();  // Hide the report table
            } else {
                $('#noSearchFoundMessage').hide();  // Hide the message if there are search queries
                $('#searchQueriesTable').show();  // Show the report table
            }
        });
    });
</script>

{% endblock %}

{% extends 'index.html' %}

{% block body %}

    <div class="container-fluid">
        <div class="container p-4 my-4 bg-primary text-white text-center rounded" >
            <h2>Case Search</h2>
        </div>
        <form id="fm" action="/search/results" method="post">
            <div class="row justify-content-center">
                <div class="col-4"><input type="text" class="form-control" name="input" value="{{ input }}" placeholder="Search" autofocus></div>        
                <div class="col-4"><button type="submit" class="btn btn-primary">Search</button></div>
            </div> 
        </form>

        {% if res is defined %}
        <div>
            <h3>{{ res['hits']['total']['value'] }} results found for "{{ input }}"</h3>
        </div>
        <hr>
        <table id="results" class="table table-hover table-bordered">
            <thead>
                <tr>
                    <th>Year</th>
                    <th>Case</th>
                    <th class="no-sort">Summary</th>
                    <th>Path</th>
                    <th>Size</th>
                </tr>
            </thead>

            
            <tbody>
                {% for hit in res['hits']['hits'] %}
                <tr>
                    <td>{{ hit['year'] }}</td>
                    <td>{{ hit['case'] }}</td>
                    <td id="{{loop.index}}" name="goodSummary"> {{ hit['good_summary']}} </td>
                    <td> {{ hit['virtual'] }} </td>
                    <td>{{ hit['_source']['file']['filesize'] }}</td>
                </tr>
                {% endfor %}
            </tbody>
            

        </table>
        {% endif %}
    </div>
    
    {% endblock %}

    {% block scripts %}
    <script  type="text/javascript">
    
        function populateText() {
            var data = document.getElementsByName("goodSummary");
            for (const item of data) {
                item.innerHTML = item.textContent
            }
        }
    
        $(document).ready( function () {
            populateText();

            $('#results').DataTable( {
                "columnDefs": [ {
                    "targets"  : 'no-sort',
                    "orderable": false,
                    "order": []
                }]
            });
        } );
        
    </script>
    {% endblock scripts %}
